"Sub-Saharan Africa (excluding high income)",
"Sub-Saharan Africa (IDA & IBRD countries)",
"Sub-Saharan Africa",
"Upper middle income",
"World"
)
data_paises <- data %>%
filter(!Country.Name %in% regiones_a_excluir)%>%
filter(anio %in% c(1985,2000,2015))
View(data_paises)
# Limpiar entorno
rm(list = ls())
# Configurar opciones globales
options(stringsAsFactors = FALSE)
options(scipen = 999)  # Evitar notaci√≥n cient√≠fica
# Librer√≠as del proyecto
library(tidyverse)
library(readxl)
library(lubridate)
library(scales)
#setwd('https://github.com/dvivone/ciencia_de_datos_TP_final/tree/main/proyecto')
#data_clean<-'https://github.com/dvivone/ciencia_de_datos_TP_final/tree/main/proyecto/data/clean'
#outstub<-'https://github.com/dvivone/ciencia_de_datos_TP_final/tree/main/proyecto/outstub'
setwd(r'(C:\Users\d185436\Documents\GitHub\ciencia_de_datos_TP_final\proyecto)')
data_clean<-file.path(r'(data/clean)')
output<-'output'
archivo_datos_inflation<-"API_FP.CPI.TOTL.ZG_DS2_en_csv_v2_130173.csv"
archivo_datos_gdp<-"API_NY.GDP.MKTP.KD.ZG_DS2_en_csv_v2_130026.csv"
archivo_datos_unemp<-"API_SL.UEM.TOTL.ZS_DS2_en_csv_v2_130165.csv"
path_inflation<-file.path(data_clean,archivo_datos_inflation)
path_gdp<-file.path(data_clean,archivo_datos_gdp)
path_unemp<-file.path(data_clean,archivo_datos_unemp)
######CARGA DATOS######
inflation <- read.csv(path_inflation,
skip = 4,
header = TRUE)
gdp <- read.csv(path_gdp,
skip=4,
header=TRUE)
unemp <- read.csv(path_unemp,
skip=4,
header=TRUE)
###LIMPIEZA DATOS#####
######INFLATION########
#Estructura de los datos
glimpse(inflation)
#eliminar columnas vac√≠as
inflation <- inflation[, 1:69]
#cambiar nombres de columnas
colnames(inflation) <- gsub("^X", "", colnames(inflation))
#pivotear
inflation_largos  <- inflation %>% pivot_longer(cols= 5:69 ,
names_to = "anio",               # Nombre de la nueva columna
values_to = "inflacion",        # Nombre de la columna de valores
names_transform = list(anio = as.numeric)  # Convertir a√±os a num√©rico
)
#seleccionar variables
inflation_largos <- inflation_largos %>%
select('Country.Name','anio','inflacion')
#######GDP#########
#Estructura de los datos
glimpse(gdp)
#eliminar columnas vac√≠as
gdp <- gdp[, 1:69]
#cambiar nombres de columnas
colnames(gdp) <- gsub("^X", "", colnames(gdp))
#pivotear
gdp_largos  <- gdp %>%
pivot_longer(cols= 5:69 ,
names_to = "anio",               # Nombre de la nueva columna
values_to = "gdp",        # Nombre de la columna de valores
names_transform = list(anio = as.numeric)  # Convertir a√±os a num√©rico
)
#seleccionar variables
gdp_largos <- gdp_largos %>%
select('Country.Name','anio','gdp')
#######unemployment##########
#Estructura de los datos
glimpse(unemp)
#eliminar columnas vac√≠as
unemp <- unemp[, 1:69]
#cambiar nombres de columnas
colnames(unemp) <- gsub("^X", "", colnames(unemp))
#pivotear
unemp_largos  <- unemp %>%
pivot_longer(cols= 5:69,
names_to = "anio",               # Nombre de la nueva columna
values_to = "unemp",        # Nombre de la columna de valores
names_transform = list(anio = as.numeric)  # Convertir a√±os a num√©rico
)
#seleccionar variables
unemp_largos <- unemp_largos %>%
select('Country.Name','anio','unemp')
####joinear todo en un unico dataset########
data <- inflation_largos %>%
left_join(gdp_largos, by = c("Country.Name", "anio")) %>%
left_join(unemp_largos, by = c("Country.Name", "anio"))
#Dimensiones del dataset - observaciones disponibles
glimpse(data)
#Detecci√≥n inicial de patrones o anomal√≠as
head(data,10)
###Excluir datos de no paises
regiones_a_excluir <- c(
"Africa Eastern and Southern",
"Africa Western and Central",
"Arab World",
"Caribbean small states",
"Central Europe and the Baltics",
"East Asia & Pacific (excluding high income)",
"East Asia & Pacific (IDA & IBRD countries)",
"East Asia & Pacific",
"Euro area",
"Europe & Central Asia (excluding high income)",
"Europe & Central Asia (IDA & IBRD countries)",
"Europe & Central Asia",
"European Union",
"Fragile and conflict affected situations",
"Heavily indebted poor countries (HIPC)",
"High income",
"IDA & IBRD total",
"IDA blend",
"IDA total",
"IDA only",
"IBRD only",
"Latin America & Caribbean (excluding high income)",
"Latin America & Caribbean (IDA & IBRD countries)",
"Latin America & Caribbean",
"Least developed countries: UN classification",
"Low & middle income",
"Low income",
"Lower middle income",
"Middle East & North Africa",
"Middle East & North Africa (IDA & IBRD countries)",
"Middle income",
"North America",
"Not classified",
"OECD members",
"Other small states",
"Pacific island small states",
"Post-demographic dividend",
"Pre-demographic dividend",
"Small states",
"South Asia",
"South Asia (IDA & IBRD)",
"Sub-Saharan Africa (excluding high income)",
"Sub-Saharan Africa (IDA & IBRD countries)",
"Sub-Saharan Africa",
"Upper middle income",
"World"
)
data_paises <- data %>%
filter(!Country.Name %in% regiones_a_excluir)%>%
filter(anio %in% c(2000,2010,2020))
View(data_paises)
# Limpiar entorno
rm(list = ls())
# Configurar opciones globales
options(stringsAsFactors = FALSE)
options(scipen = 999)  # Evitar notaci√≥n cient√≠fica
# Librer√≠as del proyecto
library(tidyverse)
library(readxl)
library(lubridate)
library(scales)
#setwd('https://github.com/dvivone/ciencia_de_datos_TP_final/tree/main/proyecto')
#data_clean<-'https://github.com/dvivone/ciencia_de_datos_TP_final/tree/main/proyecto/data/clean'
#outstub<-'https://github.com/dvivone/ciencia_de_datos_TP_final/tree/main/proyecto/outstub'
setwd(r'(C:\Users\d185436\Documents\GitHub\ciencia_de_datos_TP_final\proyecto)')
data_clean<-file.path(r'(data/clean)')
output<-'output'
archivo_datos_inflation<-"API_FP.CPI.TOTL.ZG_DS2_en_csv_v2_130173.csv"
archivo_datos_gdp<-"API_NY.GDP.MKTP.KD.ZG_DS2_en_csv_v2_130026.csv"
archivo_datos_unemp<-"API_SL.UEM.TOTL.ZS_DS2_en_csv_v2_130165.csv"
path_inflation<-file.path(data_clean,archivo_datos_inflation)
path_gdp<-file.path(data_clean,archivo_datos_gdp)
path_unemp<-file.path(data_clean,archivo_datos_unemp)
######CARGA DATOS######
inflation <- read.csv(path_inflation,
skip = 4,
header = TRUE)
gdp <- read.csv(path_gdp,
skip=4,
header=TRUE)
unemp <- read.csv(path_unemp,
skip=4,
header=TRUE)
###LIMPIEZA DATOS#####
######INFLATION########
#Estructura de los datos
glimpse(inflation)
#eliminar columnas vac√≠as
inflation <- inflation[, 1:69]
#cambiar nombres de columnas
colnames(inflation) <- gsub("^X", "", colnames(inflation))
#pivotear
inflation_largos  <- inflation %>% pivot_longer(cols= 5:69 ,
names_to = "anio",               # Nombre de la nueva columna
values_to = "inflacion",        # Nombre de la columna de valores
names_transform = list(anio = as.numeric)  # Convertir a√±os a num√©rico
)
#seleccionar variables
inflation_largos <- inflation_largos %>%
select('Country.Name','anio','inflacion')
#######GDP#########
#Estructura de los datos
glimpse(gdp)
#eliminar columnas vac√≠as
gdp <- gdp[, 1:69]
#cambiar nombres de columnas
colnames(gdp) <- gsub("^X", "", colnames(gdp))
#pivotear
gdp_largos  <- gdp %>%
pivot_longer(cols= 5:69 ,
names_to = "anio",               # Nombre de la nueva columna
values_to = "gdp",        # Nombre de la columna de valores
names_transform = list(anio = as.numeric)  # Convertir a√±os a num√©rico
)
#seleccionar variables
gdp_largos <- gdp_largos %>%
select('Country.Name','anio','gdp')
#######unemployment##########
#Estructura de los datos
glimpse(unemp)
#eliminar columnas vac√≠as
unemp <- unemp[, 1:69]
#cambiar nombres de columnas
colnames(unemp) <- gsub("^X", "", colnames(unemp))
#pivotear
unemp_largos  <- unemp %>%
pivot_longer(cols= 5:69,
names_to = "anio",               # Nombre de la nueva columna
values_to = "unemp",        # Nombre de la columna de valores
names_transform = list(anio = as.numeric)  # Convertir a√±os a num√©rico
)
#seleccionar variables
unemp_largos <- unemp_largos %>%
select('Country.Name','anio','unemp')
####joinear todo en un unico dataset########
data <- inflation_largos %>%
left_join(gdp_largos, by = c("Country.Name", "anio")) %>%
left_join(unemp_largos, by = c("Country.Name", "anio"))%>%
rename("pais"="Country.Name")
#Dimensiones del dataset - observaciones disponibles
glimpse(data)
#Detecci√≥n inicial de patrones o anomal√≠as
head(data,10)
###Excluir datos de no paises
regiones_a_excluir <- c(
"Africa Eastern and Southern",
"Africa Western and Central",
"Arab World",
"Caribbean small states",
"Central Europe and the Baltics",
"East Asia & Pacific (excluding high income)",
"East Asia & Pacific (IDA & IBRD countries)",
"East Asia & Pacific",
"Euro area",
"Europe & Central Asia (excluding high income)",
"Europe & Central Asia (IDA & IBRD countries)",
"Europe & Central Asia",
"European Union",
"Fragile and conflict affected situations",
"Heavily indebted poor countries (HIPC)",
"High income",
"IDA & IBRD total",
"IDA blend",
"IDA total",
"IDA only",
"IBRD only",
"Latin America & Caribbean (excluding high income)",
"Latin America & Caribbean (IDA & IBRD countries)",
"Latin America & Caribbean",
"Least developed countries: UN classification",
"Low & middle income",
"Low income",
"Lower middle income",
"Middle East & North Africa",
"Middle East & North Africa (IDA & IBRD countries)",
"Middle income",
"North America",
"Not classified",
"OECD members",
"Other small states",
"Pacific island small states",
"Post-demographic dividend",
"Pre-demographic dividend",
"Small states",
"South Asia",
"South Asia (IDA & IBRD)",
"Sub-Saharan Africa (excluding high income)",
"Sub-Saharan Africa (IDA & IBRD countries)",
"Sub-Saharan Africa",
"Upper middle income",
"World"
)
data_paises <- data %>%
filter(!pais %in% regiones_a_excluir)%>%
filter(anio %in% c(2000,2010,2020))
View(data_paises)
View(data_paises)
# 1. Definir las estad√≠sticas a calcular
calcular_estadisticas <- list(
media = ~mean(., na.rm = TRUE),
mediana = ~median(., na.rm = TRUE),
sd = ~sd(., na.rm = TRUE),
min = ~min(., na.rm = TRUE),
max = ~max(., na.rm = TRUE),
q25 = ~quantile(., 0.25, na.rm = TRUE),
q75 = ~quantile(., 0.75, na.rm = TRUE)
)
# 2. Generar el resumen agrupado en formato ANCHO
resumen_descriptivo_ancho <- data_paises %>%
select(where(is.numeric),-anio,) %>%
summarise(
across(
.cols = everything(),
.fns = calcular_estadisticas,
.names = "{.col}_{.fn}" # Nombrar la columna como variable_estadistica
),
.groups = "drop" # Quitar la agrupaci√≥n despu√©s de resumir
)
# 3. Mostrar el resultado final
print("üìä Resumen Descriptivo por Pa√≠s en Formato Ancho")
resumen_descriptivo_ancho
View(resumen_descriptivo_ancho)
resumen_descriptivo_largo<-resumen_descriptivo_ancho %>%
pivot_longer(cols = everything(),
names_to = "variable",
values_to = "valor")
View(resumen_descriptivo_largo)
# 1. Definir las estad√≠sticas a calcular
calcular_estadisticas <- list(
media = ~mean(., na.rm = TRUE),
mediana = ~median(., na.rm = TRUE),
sd = ~sd(., na.rm = TRUE),
min = ~min(., na.rm = TRUE),
max = ~max(., na.rm = TRUE),
q25 = ~quantile(., 0.25, na.rm = TRUE),
q75 = ~quantile(., 0.75, na.rm = TRUE)
)
# 2. Generar el resumen agrupado en formato ANCHO
resumen_descriptivo_ancho <- data_paises %>%
select(where(is.numeric),-anio,) %>%
summarise(
across(
.cols = everything(),
.fns = calcular_estadisticas,
.names = "{.col}_{.fn}" # Nombrar la columna como variable_estadistica
),
.groups = "drop" # Quitar la agrupaci√≥n despu√©s de resumir
)
# 2. Generar el resumen agrupado en formato LARGO
resumen_descriptivo_largo<-resumen_descriptivo_ancho %>%
pivot_longer(cols = everything(),
names_to = "variable",
values_to = "valor")
# 3. Mostrar el resultado final
print("üìä Resumen Descriptivo en formato largo")
resumen_descriptivo_largo
View(resumen_descriptivo_largo)
resumen_faltantes <- data_paises %>%
miss_var_summary() %>%
filter(n_miss > 0)
View(resumen_faltantes)
p1 <- gg_miss_var(data_paises, show_pct = TRUE) +
labs(title = "Porcentaje de valores faltantes por variable",
y = "Variables") +
theme(axis.text.y = element_text(size = 10))
p1
# Patr√≥n de datos faltantes (heatmap)
p2 <- vis_miss(data_paises %>%
select(inflacion, unemp, gdp),
cluster = TRUE) +
labs(title = "Patr√≥n de datos faltantes",
subtitle = "Negro = Faltante, Gris = Observado")
p2
# Gr√°fico de barras de porcentaje faltante
p1 <- vis_miss_var(data_paises, show_pct = TRUE) +
labs(title = "Porcentaje de valores faltantes por variable",
y = "Variables") +
theme(axis.text.y = element_text(size = 10))
####Test MCAR
# Preparar datos para el test
datos_para_test <- data_paises %>%
select(where(is.numeric)) %>%
select(where(~any(is.na(.))))
# Realizar test de Little
test_mcar <- naniar::mcar_test(datos_para_test)
resultados_mcar <- data.frame(
Estadistico = round(test_mcar$statistic, 2),
`Grados de libertad` = test_mcar$df,
`P-value` = format(test_mcar$p.value, scientific = TRUE),
Conclusion = ifelse(test_mcar$p.value < 0.05,
"Rechazamos H0: Datos NO son MCAR",
"No rechazamos H0: Datos podr√≠an ser MCAR")
)
View(resultados_mcar)
resultados_mcar %>%
kable(caption = "Resultados del Test de Little para MCAR") %>%
kable_styling(bootstrap_options = "striped", full_width = FALSE) %>%
column_spec(4, bold = TRUE,
color = ifelse(test_mcar$p.value < 0.05, "red", "green"))
data_imputar <- data_paises %>%
mutate(Country.Name = as.factor(Country.Name))
data_imputar <- data_paises %>%
mutate(pais = as.factor(pais))
# 2. Verificar la estructura de las variables
str(data_imputar)
library(naniar)
library(patchwork)
library(kableExtra)
library(mice)
#Calcular estad√≠sticas de faltantes
resumen_faltantes <- data_paises %>%
miss_var_summary() %>%
filter(n_miss > 0)
# Gr√°fico de barras de porcentaje faltante
p1 <- gg_miss_var(data_paises, show_pct = TRUE) +
labs(title = "Porcentaje de valores faltantes por variable",
y = "Variables") +
theme(axis.text.y = element_text(size = 10))
p1
# Patr√≥n de datos faltantes (heatmap)
p2 <- vis_miss(data_paises %>%
select(inflacion, unemp, gdp),
cluster = TRUE) +
labs(title = "Patr√≥n de datos faltantes",
subtitle = "Negro = Faltante, Gris = Observado")
p2
# Combinar gr√°ficos
p1 / p2
####Test MCAR
# Preparar datos para el test
datos_para_test <- data_paises %>%
select(where(is.numeric)) %>%
select(where(~any(is.na(.))))
# Realizar test de Little
test_mcar <- naniar::mcar_test(datos_para_test)
resultados_mcar <- data.frame(
Estadistico = round(test_mcar$statistic, 2),
`Grados de libertad` = test_mcar$df,
`P-value` = format(test_mcar$p.value, scientific = TRUE),
Conclusion = ifelse(test_mcar$p.value < 0.05,
"Rechazamos H0: Datos NO son MCAR",
"No rechazamos H0: Datos podr√≠an ser MCAR")
)
resultados_mcar %>%
kable(caption = "Resultados del Test de Little para MCAR") %>%
kable_styling(bootstrap_options = "striped", full_width = FALSE) %>%
column_spec(4, bold = TRUE,
color = ifelse(test_mcar$p.value < 0.05, "red", "green"))
##### Imputaci√≥n m√∫ltiple############
# 1. Asegurar que las variables clave tengan el formato correcto
data_imputar <- data_paises %>%
mutate(pais = as.factor(pais))
# 2. Verificar la estructura de las variables
str(data_imputar)
# 2. Configurar la imputaci√≥n MICE
#####################################################################
#PREPARACI√ìN Y CONFIGURACI√ìN MICE PARA DATOS DE PANEL
#####################################################################
# 1. Asegurar que la variable de cluster es un FACTOR y luego convertirla a INTEGER
data_imputar <- data_paises %>%
mutate(
# Primero aseguramos que es un factor (necesario para mantener el orden)
pais_Factor = as.factor(pais),
# Luego convertimos el factor a un entero.
# Cada nivel del factor (cada pa√≠s) recibir√° un identificador num√©rico √∫nico (1, 2, 3, ...)
pais_ID = as.integer(pais_Factor)
) %>%
# Quitamos la columna original del nombre si data_paises la ten√≠a y no la vamos a imputar
select(-pais_Factor) # Mantenemos solo el ID para MICE
# 2. Configurar la imputaci√≥n MICE
# Variables con NAs a imputar
variables_a_imputar <- c("inflacion", "gdp", "unemp")
# Generar la matriz de predicci√≥n inicial usando el nuevo dataframe
ini <- mice(data_imputar, maxit = 0)
pred_matrix <- ini$predictorMatrix
method_vector <- ini$method
# 3. Aplicar el m√©todo de imputaci√≥n multinivel ('2l.pan')
for (var in variables_a_imputar) {
# Establecer el m√©todo de imputaci√≥n multinivel
method_vector[var] <- "2l.pan"
# ¬°IMPORTANTE! Indicar que 'Country.Name_ID' es la variable de cluster (c√≥digo -2)
# Usamos la nueva variable integer
pred_matrix[var, "pais_ID"] <- -2
# Asegurar que el Country.Name original (si existe) no se use para predecir ni se impute
# Si la columna Country.Name original a√∫n existe en data_imputar, excl√∫yela:
# pred_matrix[, "Country.Name"] <- 0
# method_vector["Country.Name"] <- ""
}
# 4. Ejecutar la imputaci√≥n
m <- 5
maxit <- 10
mice_imp_panel <- mice(
data_imputar,
method = method_vector,
predictorMatrix = pred_matrix,
m = m,
maxit = maxit,
seed = 42
)
##### Comparaci√≥n imputaci√≥n #####
# 1. Preparar datos para comparaci√≥n, a√±adiendo una columna de origen
comparacion_dist <- bind_rows(
data_paises %>%
select(inflacion, gdp, unemp) %>%
mutate(Origen = "Original"),
datos_imp_mice %>%
select(inflacion, gdp, unemp) %>% # Asegurar que solo se incluyan las mismas columnas
mutate(Origen = "Imputado")
)
